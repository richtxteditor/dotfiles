# ==================================================================== #
#               ~/.tmux.conf - A Modern & Complete Config              #
# ==================================================================== #
# - Prefix: Ctrl+a
# - vi mode for copy/paste
# - Sensible defaults and modern settings
# - TPM plugin support with session persistence
# -------------------------------------------------------------------- #

# -------------------------------------------------------------------- #
# SECTION 1: General Settings
# -------------------------------------------------------------------- #

# Set prefix key to Ctrl+a (a common, ergonomic alternative to Ctrl+b)
unbind C-b
set -g prefix C-a
bind C-a send-prefix

# Set base index for windows and panes to 1 instead of 0 for easier counting
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows automatically when a window is closed
set -g renumber-windows on

# Increase scrollback history buffer size
set -g history-limit 10000

# Reduce delay between prefix and command key for a more responsive feel
set -g escape-time 10

# Set message display time to a shorter duration (default is 750ms)
set -g display-time 600

# Enable full mouse support (scrolling, pane selection, resizing)
set -g mouse on

# Enable focus events, required by modern editors like Neovim
set-option -g focus-events on

# Set terminal type to support 256 colors and True Color
# This is the modern standard for rich color support in the terminal
set -g default-terminal "tmux-256color"
set -as terminal-overrides ',*:Tc' # Enable True Color (24-bit)

# -------------------------------------------------------------------- #
# SECTION 2: Keybindings
# -------------------------------------------------------------------- #

# Reload tmux config file with Prefix + r
bind r source-file ~/.tmux.conf \; display "Config reloaded!"

# --- Panes ---
# Split panes using | (vertical) and - (horizontal) in the current path
bind | split-window -h -c '#{pane_current_path}'
bind - split-window -v -c '#{pane_current_path}'
unbind '"' # Unbind default horizontal split
unbind %   # Unbind default vertical split

# Switch panes using Vim movement keys
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Resize panes using Vim movement keys (repeatable)
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Maximize/restore current pane
bind z resize-pane -Z

# Break pane into a new window
bind b break-pane -d

# --- Windows ---
# Create new window in the current path
bind c new-window -c '#{pane_current_path}'

# Navigate windows easily (repeatable)
bind -r n next-window
bind -r p previous-window

# Kill current pane/window with confirmation
bind x confirm-before -p "kill-pane #P? (y/n)" kill-pane
bind X confirm-before -p "kill-window #W? (y/n)" kill-window

# --- Copy Mode (vi bindings) ---
# Set vi mode for copy mode
setw -g mode-keys vi

# Start selection with 'v' (like in Vim)
bind-key -T copy-mode-vi v send-keys -X begin-selection
# Yank selection to system clipboard (macOS) with 'y'
bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"
# Yank on mouse drag end
bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "pbcopy"

# -------------------------------------------------------------------- #
# SECTION 3: Plugins (using TPM - Tmux Plugin Manager)
# -------------------------------------------------------------------- #

# List of plugins
set -g @plugin 'tmux-plugins/tpm'            # Plugin manager itself
set -g @plugin 'tmux-plugins/tmux-sensible'  # Sensible default settings (recommended)

# -- Theme: Kanagawa --
set -g @plugin 'Nybkox/tmux-kanagawa'
set -g @kanagawa-theme 'dragon'
set -g @kanagawa-ignore-window-colors true
set -g @kanagawa-show-powerline true
set -g @kanagawa-show-left-icon session
set -g @kanagawa-show-flags true
set -g @kanagawa-plugins "cpu-usage ram-usage battery date time"

# -- Session Persistence --
set -g @plugin 'tmux-plugins/tmux-resurrect' # Persists tmux environment across restarts
set -g @plugin 'tmux-plugins/tmux-continuum' # Automatically saves/restores sessions

# Configuration for Continuum and Resurrect
set -g @continuum-restore 'on'               # Enable auto-restore on tmux start
set -g @resurrect-capture-pane-contents 'on' # Restore pane content (scrollback)
set -g @resurrect-continue-without-prompt 'on' # **FIX:** No prompt after restore

# -- Utility Plugins --
set -g @plugin 'tmux-plugins/tmux-yank'      # Enhanced copy-paste, works with system clipboard
set -g @plugin 'tmux-plugins/tmux-open'      # Open files/URLs from tmux (Prefix + o)
set -g @plugin 'tmux-plugins/tmux-sessionist' # Easy session management menu (Prefix + T)


# -------------------------------------------------------------------- #
# SECTION 4: Initialize TPM
# IMPORTANT: Keep this line at the very bottom of your tmux.conf
# -------------------------------------------------------------------- #

run '~/.tmux/plugins/tpm/tpm'